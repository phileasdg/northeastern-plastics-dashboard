<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Northeastern Plastics Center | Data Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <!-- Leaflet.js for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Lighter Slate background */
            color: #334155;
            overflow-y: hidden; /* Prevent body scroll on large screens */
        }
        #map-background {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 0;
        }
        .panel-card {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border-radius: 12px;
            border: 1px solid rgba(203, 213, 225, 0.5);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        .tab-active {
            border-bottom: 2px solid #0d9488; /* Teal Accent */
            color: #0f172a;
        }
        .tab-inactive {
            color: #64748b;
        }
        /* Leaflet Map Styling - REVISED FOR LIGHT THEME */
        .leaflet-tooltip-custom {
            background: rgba(255, 255, 255, 0.85) !important;
            backdrop-filter: blur(10px) !important;
            -webkit-backdrop-filter: blur(10px) !important;
            border: 1px solid rgba(0, 0, 0, 0.1) !important;
            color: #334155 !important;
            border-radius: 6px !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
        }
        .leaflet-tooltip-custom::before {
             border-top-color: rgba(255, 255, 255, 0.85) !important;
        }
        .leaflet-tooltip-bottom.leaflet-tooltip-custom::before {
            border-bottom-color: rgba(255, 255, 255, 0.85) !important;
            border-top-color: transparent !important;
        }

        /* Custom popup styling for light theme */
        .custom-leaflet-popup .leaflet-popup-content-wrapper {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #334155;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 1rem;
        }
        .custom-leaflet-popup .leaflet-popup-content {
            margin: 0;
            line-height: 1.5;
            font-size: 14px;
        }
        .custom-leaflet-popup .leaflet-popup-tip-container {
            width: 40px;
            height: 20px;
        }
        .custom-leaflet-popup .leaflet-popup-tip {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            box-shadow: none;
        }

        .leaflet-container {
            font-family: 'Inter', sans-serif;
            background-color: transparent;
        }
        .leaflet-control-zoom {
            border: 1px solid rgba(203, 213, 225, 0.5) !important;
        }
        .leaflet-control-zoom a {
            background-color: rgba(255, 255, 255, 0.7) !important;
            color: #0f172a !important;
        }

        /* Data Loading Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out forwards;
        }
    </style>
</head>
<body class="text-slate-700">
    <div id="map-background"></div>
    <div class="relative z-10 h-screen flex flex-col pointer-events-none">
        <!-- Header -->
        <header class="p-4 md:p-6 pointer-events-auto flex-shrink-0">
             <div class="container mx-auto panel-card">
                <div class="p-4 flex flex-wrap justify-between items-center gap-y-3">
                    <a href="https://plastics.sites.northeastern.edu/" target="_blank" class="flex items-center space-x-3 group">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-teal-600">
                            <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" fill="currentColor"/>
                             <path d="M12 2L12 12M22 7L12 12M2 7L12 12M12 22V12" stroke="#f1f5f9" stroke-width="1.5"/>
                        </svg>
                        <div>
                            <h1 class="text-xl md:text-2xl font-bold text-slate-800 tracking-tight group-hover:text-teal-700 transition-colors">Northeastern Plastics Center</h1>
                            <p class="text-xs md:text-sm text-slate-500">Global Plastics Data Dashboard</p>
                        </div>
                    </a>
                    <nav class="flex space-x-2 md:space-x-4 text-sm md:text-base font-medium">
                        <button id="tab-map" class="tab-active py-2 px-3 transition-colors duration-300">Map</button>
                        <button id="tab-dashboard" class="tab-inactive py-2 px-3 transition-colors duration-300">Dashboard</button>
                        <button id="tab-sources" class="tab-inactive py-2 px-3 transition-colors duration-300">Data Sources</button>
                        <button id="tab-about" class="tab-inactive py-2 px-3 transition-colors duration-300">About</button>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Map Search Widget -->
        <div id="map-search-widget" class="absolute bottom-4 left-1/2 -translate-x-1/2 z-20 w-full max-w-xs md:max-w-sm pointer-events-auto">
            <div class="panel-card p-4">
                <h3 class="font-semibold text-slate-700 mb-2">Explore Data Hotspots</h3>
                <div class="relative">
                    <div class="flex gap-2">
                        <input type="text" id="map-search-input" placeholder="Search for a region or place..." class="w-full px-3 py-2 text-sm bg-white/50 border border-slate-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:outline-none">
                        <button id="map-search-btn" class="px-4 py-2 bg-teal-600 text-white font-semibold rounded-md hover:bg-teal-700 transition-colors transform hover:scale-105">Search</button>
                    </div>
                    <div id="search-results" class="absolute bottom-full left-0 right-0 mb-2 bg-white/95 backdrop-blur-sm border border-slate-200 rounded-md shadow-lg z-50 hidden overflow-hidden">
                        <!-- Search results will be injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto px-2 md:px-4 pb-4 flex flex-col min-h-0">
            <!-- Map View -->
            <div id="view-map" class="flex-grow">
            </div>

            <!-- Dashboard View -->
            <div id="view-dashboard" class="hidden pointer-events-auto flex flex-col h-full">
                <!-- Key Metrics -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mb-4 flex-shrink-0">
                    <div class="panel-card p-4">
                        <h3 class="text-sm font-medium text-slate-500">Global Plastic Production</h3>
                        <p class="text-2xl md:text-3xl font-bold text-slate-800">460 <span class="text-base font-medium text-slate-600">MT</span></p>
                        <p class="text-xs text-emerald-600">+3.5% vs. last year</p>
                    </div>
                    <div class="panel-card p-4">
                        <h3 class="text-sm font-medium text-slate-500">Global Recycling Rate</h3>
                        <p class="text-2xl md:text-3xl font-bold text-slate-800">9.1<span class="text-base font-medium text-slate-600">%</span></p>
                        <p class="text-xs text-emerald-600">+0.2% vs. last year</p>
                    </div>
                    <div class="panel-card p-4">
                        <h3 class="text-sm font-medium text-slate-500">Ocean Plastic Waste</h3>
                        <p class="text-2xl md:text-3xl font-bold text-slate-800">11 <span class="text-base font-medium text-slate-600">MT/yr</span></p>
                        <p class="text-xs text-rose-600">+1.8% vs. last year</p>
                    </div>
                    <div class="panel-card p-4">
                        <h3 class="text-sm font-medium text-slate-500">Mismanaged Waste</h3>
                        <p class="text-2xl md:text-3xl font-bold text-slate-800">79 <span class="text-base font-medium text-slate-600">MT</span></p>
                        <p class="text-xs text-rose-600">+2.1% vs. last year</p>
                    </div>
                </div>
                
                <!-- Main Visuals Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-2 md:gap-4 flex-grow min-h-0">
                    <div class="panel-card p-4 flex flex-col">
                        <h3 class="font-semibold text-slate-700">Fate of Global Plastic Waste</h3>
                        <div class="flex-grow w-full h-full min-h-[200px]"><canvas id="fateChart"></canvas></div>
                    </div>
                    <div class="panel-card p-4 flex flex-col">
                        <h3 class="font-semibold text-slate-700">Plastic Production by Polymer</h3>
                        <div class="flex-grow w-full h-full min-h-[200px]"><canvas id="polymerChart"></canvas></div>
                    </div>
                    <div class="panel-card p-4 flex flex-col">
                        <h3 class="font-semibold text-slate-700">Global Plastic Waste Generation</h3>
                        <div class="flex-grow w-full h-full min-h-[200px]"><canvas id="wasteTrendChart"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- Data Sources View -->
            <div id="view-sources" class="hidden panel-card p-6 md:p-8 pointer-events-auto overflow-y-auto">
                <h2 class="text-2xl font-bold mb-6 text-slate-800">Data & Resources</h2>
                
                <h3 class="text-xl font-bold mb-4 text-teal-800">Core Data Sources</h3>
                <div class="space-y-6 mb-8">
                    <div>
                        <h4 class="text-lg font-semibold text-slate-700">Our World in Data</h4>
                        <p class="text-slate-600 mt-1 mb-2">Comprehensive datasets and visualizations on plastic pollution, production, and waste management. An excellent starting point for research.</p>
                        <a href="https://ourworldindata.org/plastic-pollution" target="_blank" class="text-sm text-teal-600 hover:underline">Visit Site &rarr;</a>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-700">UN Environment Programme (UNEP)</h4>
                        <p class="text-slate-600 mt-1 mb-2">Reports and data on the global environmental impact of plastics, international policies, and initiatives like the Global Plastics Treaty.</p>
                        <a href="https://www.unep.org/plastic-pollution" target="_blank" class="text-sm text-teal-600 hover:underline">Visit Site &rarr;</a>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-700">OECD Global Plastics Outlook</h4>
                        <p class="text-slate-600 mt-1 mb-2">In-depth analysis and projections on plastic production, use, and waste, providing a key economic perspective.</p>
                        <a href="https://www.oecd.org/environment/plastic-pollution-and-the-environment.htm" target="_blank" class="text-sm text-teal-600 hover:underline">Visit Site &rarr;</a>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-700">NOAA Marine Debris Program (MDMAP)</h4>
                        <p class="text-slate-600 mt-1 mb-2">A citizen-science database and visualization platform for shoreline marine debris data collected across the United States.</p>
                        <a href="https://mdmap.orr.noaa.gov/visualize" target="_blank" class="text-sm text-teal-600 hover:underline">Visit Site &rarr;</a>
                    </div>
                </div>

                <h3 class="text-xl font-bold mb-4 text-teal-800">Related Dashboards & Platforms</h3>
                <div class="space-y-6">
                    <div>
                        <h4 class="text-lg font-semibold text-slate-700">The World Bank | What a Waste</h4>
                        <p class="text-slate-600 mt-1 mb-2">A global database on solid waste management, including plastics. Explore country-level data and projections through interactive tools.</p>
                        <a href="https://datatopics.worldbank.org/what-a-waste/" target="_blank" class="text-sm text-teal-600 hover:underline">Visit Dashboard &rarr;</a>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-700">Minderoo Foundation | Plastic Waste Makers Index</h4>
                        <p class="text-slate-600 mt-1 mb-2">Tracks the producers of the polymers that become single-use plastic waste. An important resource for understanding the source of the issue.</p>
                        <a href="https://www.minderoo.org/plastic-waste-makers-index/" target="_blank" class="text-sm text-teal-600 hover:underline">View Index &rarr;</a>
                    </div>
                </div>
            </div>

            <!-- About View -->
            <div id="view-about" class="hidden panel-card p-6 md:p-8 pointer-events-auto overflow-y-auto">
                <h2 class="text-2xl font-bold mb-6 text-slate-800">About the Dashboard</h2>
                <div class="space-y-4 text-slate-600">
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi. Proin porttitor, orci nec nonummy molestie, enim est eleifend mi, non fermentum diam nisl sit amet erat.</p>
                    <p>Duis semper. Duis arcu massa, scelerisque vitae, consequat in, pretium a, enim. Pellentesque congue. Ut in risus volutpat libero pharetra tempor. Cras vestibulum bibendum augue. Praesent egestas leo in pede. Praesent blandit odio eu enim. Pellentesque sed dui ut augue blandit sodales. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam nibh.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Tab navigation
            const tabs = {
                map: document.getElementById('tab-map'),
                dashboard: document.getElementById('tab-dashboard'),
                sources: document.getElementById('tab-sources'),
                about: document.getElementById('tab-about'),
            };
            const views = {
                map: document.getElementById('view-map'),
                dashboard: document.getElementById('view-dashboard'),
                sources: document.getElementById('view-sources'),
                about: document.getElementById('view-about'),
            };
            const searchWidget = document.getElementById('map-search-widget');

            let fateChartInstance, polymerChartInstance, wasteTrendChartInstance;

            function switchTab(activeTab) {
                Object.keys(tabs).forEach(key => {
                    const tab = tabs[key];
                    const view = views[key];
                    if (key === activeTab) {
                        view.style.display = 'block';
                        tab.classList.remove('tab-inactive');
                        tab.classList.add('tab-active');
                    } else {
                        view.style.display = 'none';
                        tab.classList.remove('tab-active');
                        tab.classList.add('tab-inactive');
                    }
                });

                if (activeTab === 'map') {
                    searchWidget.style.display = 'block';
                } else {
                    searchWidget.style.display = 'none';
                    map.closePopup(); // Close any open popups when leaving map view
                }
                
                // Animate charts on view by re-creating them
                if (activeTab === 'dashboard') {
                     // Use a small timeout to ensure the canvas elements are visible and have dimensions
                    setTimeout(createDashboardCharts, 50);
                }
            }

            // Set default tab
            switchTab('map');

            Object.keys(tabs).forEach(key => {
                tabs[key].addEventListener('click', () => switchTab(key));
            });

            // Mock Data for Map Hotspots
            const mapPoints = [
                {
                    name: 'East Asia', waste: 28.5, lat: 34, lon: 104,
                    summary: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.',
                    link: 'https://ourworldindata.org/plastic-pollution',
                    composition: { PE: 35, PP: 25, PET: 20, Other: 20 }
                },
                {
                    name: 'Southeast Asia', waste: 12.1, lat: 10, lon: 115,
                    summary: 'Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.',
                    link: 'https://ourworldindata.org/plastic-pollution',
                    composition: { PE: 40, PP: 22, PET: 18, Other: 20 }
                },
                {
                    name: 'South Asia', waste: 9.8, lat: 20, lon: 78,
                    summary: 'Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.',
                    link: 'https://ourworldindata.org/plastic-pollution',
                    composition: { PE: 38, PP: 20, PET: 22, Other: 20 }
                },
                {
                    name: 'North America', waste: 5.5, lat: 45, lon: -100,
                    summary: 'Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.',
                    link: 'https://www.oecd.org/environment/plastic-pollution-and-the-environment.htm',
                    composition: { PE: 28, PP: 35, PET: 25, Other: 12 }
                },
                {
                    name: 'Europe', waste: 4.8, lat: 50, lon: 15,
                    summary: 'Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.',
                    link: 'https://www.oecd.org/environment/plastic-pollution-and-the-environment.htm',
                    composition: { PE: 30, PP: 32, PET: 28, Other: 10 }
                },
                {
                    name: 'South America', waste: 4.1, lat: -15, lon: -60,
                    summary: 'Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores.',
                    link: 'https://www.unep.org/plastic-pollution',
                    composition: { PE: 45, PP: 25, PET: 15, Other: 15 }
                },
                {
                    name: 'Africa', waste: 6.2, lat: 0, lon: 20,
                    summary: 'Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam.',
                    link: 'https://www.unep.org/plastic-pollution',
                    composition: { PE: 50, PP: 18, PET: 12, Other: 20 }
                }
            ];

            // Initialize Leaflet Map
            const map = L.map('map-background', {
                center: [20, 30],
                zoom: 3,
                minZoom: 2, // Prevent zooming out to see map edges
                zoomControl: true,
                attributionControl: false,
                maxBounds: [ // Restrict vertical panning
                    [-85.0511, -180],
                    [85.0511, 180]
                ],
                worldCopyJump: true // Allow infinite horizontal scroll
            });
            map.zoomControl.setPosition('bottomright');

            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 19,
            }).addTo(map);
            
            function createPopupHtml(point) {
                const colors = { PE: '#0ea5e9', PP: '#06b6d4', PET: '#3b82f6', Other: '#64748b' };
                const chartHtml = Object.entries(point.composition).map(([polymer, value]) => `
                    <div class="w-full flex items-center text-xs mb-1">
                        <span class="w-10 font-medium text-slate-500">${polymer}</span>
                        <div class="flex-grow h-4 bg-slate-200 rounded-sm overflow-hidden">
                            <div title="${value}%" style="width: ${value}%; background-color: ${colors[polymer] || '#64748b'};" class="h-full"></div>
                        </div>
                    </div>
                `).join('');

                return `
                    <div class="w-64">
                        <h4 class="font-bold text-lg mb-2 text-slate-800">${point.name}</h4>
                        <p class="text-sm text-slate-600 mb-3">${point.summary}</p>
                        <div class="mb-3">
                            <h5 class="font-semibold text-sm mb-1 text-slate-700">Waste Composition (Est.)</h5>
                            ${chartHtml}
                        </div>
                        <a href="${point.link}" target="_blank" class="text-sm text-teal-600 hover:text-teal-700 font-semibold transition-colors">Learn More &rarr;</a>
                    </div>
                `;
            }

            const headerEl = document.querySelector('header .panel-card');
            const headerHeight = headerEl ? headerEl.offsetHeight : 120;

            mapPoints.forEach(point => {
                const circle = L.circleMarker([point.lat, point.lon], {
                    radius: 4 + (point.waste / 3), // Scale radius based on waste
                    fillColor: "#0d9488",
                    color: "#0f766e",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7
                }).addTo(map);

                circle.bindTooltip(`<strong>${point.name}</strong><br>${point.waste}M tonnes`, {
                    permanent: false, direction: 'bottom', className: 'leaflet-tooltip-custom', offset: L.point(0, 10)
                });

                // Detailed click popup
                circle.bindPopup(createPopupHtml(point), {
                    className: 'custom-leaflet-popup',
                    offset: L.point(0, 15), // Anchor popup below the point
                    autoPanPadding: L.point(10, headerHeight + 15) // Use padding to avoid UI elements
                });

                // Store reference to layer for easy access
                point.layer = circle;
            });

            // --- NEW & IMPROVED SEARCH FUNCTIONALITY ---
            const searchInput = document.getElementById('map-search-input');
            const searchBtn = document.getElementById('map-search-btn');
            const searchResultsContainer = document.getElementById('search-results');

            // 1. Live search for data hotspots
            searchInput.addEventListener('input', () => {
                const query = searchInput.value.toLowerCase();
                searchResultsContainer.innerHTML = '';
                
                if (query.length < 2) {
                    searchResultsContainer.classList.add('hidden');
                    return;
                }

                const results = mapPoints.filter(p => p.name.toLowerCase().includes(query));
                
                if (results.length > 0) {
                    results.forEach(result => {
                        const resultEl = document.createElement('div');
                        resultEl.className = 'p-3 text-sm text-slate-700 cursor-pointer hover:bg-sky-100';
                        resultEl.textContent = result.name;
                        resultEl.onclick = () => {
                            flyToHotspot(result);
                            searchInput.value = result.name;
                            searchResultsContainer.classList.add('hidden');
                        };
                        searchResultsContainer.appendChild(resultEl);
                    });
                    searchResultsContainer.classList.remove('hidden');
                } else {
                    searchResultsContainer.classList.add('hidden');
                }
            });

            // Hide results when clicking outside
            document.addEventListener('click', function(event) {
                if (!searchInput.contains(event.target) && !searchResultsContainer.contains(event.target)) {
                    searchResultsContainer.classList.add('hidden');
                }
            });

            // 2. Function to fly to a data hotspot
            function flyToHotspot(hotspot) {
                map.flyTo([hotspot.lat, hotspot.lon], 5);
                hotspot.layer.openPopup();
            }

            // 3. Final search action (button or Enter key)
            async function performSearch() {
                const query = searchInput.value.trim();
                if (!query) return;

                searchResultsContainer.classList.add('hidden');

                // First, check if it's a known data hotspot
                const hotspotResult = mapPoints.find(p => p.name.toLowerCase() === query.toLowerCase());
                if (hotspotResult) {
                    flyToHotspot(hotspotResult);
                    return;
                }

                // If not, use a geocoding service to find any place
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=1`);
                    const data = await response.json();
                    if (data && data.length > 0) {
                        const { lat, lon } = data[0];
                        map.flyTo([lat, lon], 10); // Zoom closer for specific places
                    } else {
                        showSearchError('Place not found');
                    }
                } catch (error) {
                    console.error("Geocoding API error:", error);
                    showSearchError('Search failed');
                }
            }

            function showSearchError(message) {
                 const originalPlaceholder = searchInput.placeholder;
                 searchInput.value = message;
                 searchInput.classList.add('placeholder-red-500');
                 setTimeout(() => {
                    searchInput.value = '';
                    searchInput.classList.remove('placeholder-red-500');
                    searchInput.placeholder = originalPlaceholder;
                 }, 2500);
            }
            
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            function createDashboardCharts() {
                // Destroy existing charts to re-trigger animations
                if (fateChartInstance) fateChartInstance.destroy();
                if (polymerChartInstance) polymerChartInstance.destroy();
                if (wasteTrendChartInstance) wasteTrendChartInstance.destroy();

                // Chart.js Configuration
                Chart.defaults.font.family = 'Inter';
                Chart.defaults.color = '#64748b';
                Chart.defaults.borderColor = 'rgba(100, 116, 139, 0.1)';

                // --- POLISHED TOOLTIP CONFIG ---
                const polishedTooltip = {
                    enabled: true,
                    backgroundColor: 'rgba(255, 255, 255, 0.9)',
                    backdropFilter: 'blur(5px)',
                    titleColor: '#1e293b',
                    bodyColor: '#475569',
                    borderColor: 'rgba(0, 0, 0, 0.1)',
                    borderWidth: 1,
                    padding: 12,
                    cornerRadius: 8,
                    displayColors: false,
                };

                // Fate of Waste Chart (Doughnut)
                fateChartInstance = new Chart(document.getElementById('fateChart').getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Landfilled', 'Recycled', 'Incinerated', 'Mismanaged'],
                        datasets: [{
                            data: [50, 9.1, 19, 21.9],
                            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'],
                            borderColor: '#f8fafc',
                            borderWidth: 5
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        plugins: { 
                            legend: { position: 'bottom', labels: { padding: 15 } },
                            tooltip: { ...polishedTooltip, callbacks: {
                                label: (context) => `${context.label}: ${context.parsed}%`
                            }}
                        } 
                    }
                });
                
                // Polymer Production Chart (Bar)
                polymerChartInstance = new Chart(document.getElementById('polymerChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['PE', 'PP', 'PVC', 'PET', 'PS', 'Other'],
                        datasets: [{
                            label: 'Million Tonnes',
                            data: [120, 105, 85, 70, 35, 45],
                            backgroundColor: ['#0ea5e9', '#06b6d4', '#14b8a6', '#3b82f6', '#8b5cf6', '#64748b'],
                            borderWidth: 0
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        indexAxis: 'y', 
                        scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { color: 'rgba(100, 116, 139, 0.1)' } } }, 
                        plugins: { 
                            legend: { display: false },
                            tooltip: { ...polishedTooltip, callbacks: {
                                title: () => '', // Hide title
                                label: (context) => `${context.label}: ${context.parsed.x} MT`
                            }}
                        } 
                    }
                });

                // Waste Trend Chart (Line)
                wasteTrendChartInstance = new Chart(document.getElementById('wasteTrendChart').getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['1950', '1970', '1990', '2010', '2024'],
                        datasets: [{
                            label: 'Global Plastic Waste (MT)',
                            data: [2, 30, 145, 275, 353],
                            fill: true,
                            backgroundColor: 'rgba(13, 148, 136, 0.1)',
                            borderColor: '#0d9488',
                            tension: 0.3,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#0d9488',
                            pointHoverRadius: 6,
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        scales: { y: { beginAtZero: true }, x: { grid: { display: false } } }, 
                        plugins: { 
                            legend: { display: false },
                            tooltip: { ...polishedTooltip, callbacks: {
                                label: (context) => `Year ${context.label}: ${context.parsed.y} MT`
                            }}
                        } 
                    }
                });
            }
        });
    </script>
</body>
</html>